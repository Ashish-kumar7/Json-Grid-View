# Imports
import numpy as np
import pandas as pd

# Global Constants
__reqCols = set()
__colTree = {}


def isScalarData(data):
    if data == None:
        return True
    return np.isscalar(data)


def isListOfDict(data):
    if not type(data) is list:
        return False
    for x in data:
        if not type(x) is dict:
            return False
    return True


def isScalarList(data):
    if not type(data) is list:
        return False

    return not isListOfDict(data)


def isScalar(data):
    return isScalarData(data) or isScalarList(data)


def dfsGenCol(data, pref):
    global __colTree
    global __reqCols
    if isListOfDict(data):
        for x in data:
            dfsGenCol(x, pref)

    elif type(data) is dict:
        for x in data:
            colName = str(x) if (pref == "") else (pref + '.' + str(x))
            __colTree[pref].add(colName)
            if isScalar(data[x]):
                __reqCols.add(colName)
            else:
                __colTree[colName] = set()
                dfsGenCol(data[x], colName)


def GenTableSchema(data):
    __colTree = {"": set()}
    __reqCols = set()
    dfsGenCol(data, '')
    return (__reqCols, __colTree)
